<loader *ngIf="loading"></loader>
<div class="container" *ngIf="!loading">

    <h2>Recuperar password</h2>

    <div style="height: 50px;">
        <p class="text-danger"> {{ '_Mandatory_' | translate }} </p>
    </div>

    <alert *ngIf="success" type="success" dismissOnTimeout="5000" (onClosed)="reset()"> {{ textSuccess }} </alert>
    <alert *ngIf="failure" type="danger" dismissOnTimeout="5000" (onClosed)="reset()"> {{ textFailure }} </alert>

    <form (ngSubmit)="getQuestion()" #recoverForm="ngForm" class="col-md-8">
        <div class="row">
            <div class="form-group">
                <label for="username">{{ '_Username_' | translate }} <span class="text-danger"> * </span></label>
                <input type="text" (input)="validateUsername()" class="form-control" id="username" required pattern="^[A-Za-z0-9_-]{3,15}$" maxlength="30" [(ngModel)]="username" name="username">
                <div *ngIf="usernameError" class="alert alert-danger"> {{ '_RequiredUsername_' | translate }} </div>
            </div>
        </div>
        <div class="row" *ngIf="usernameOk">
            <div class="form-group">
                <label for="question"> {{ securityQuestion }} <span class="text-danger"> * </span></label>
                <input type="text" (input)="validateAnswer()" class="form-control" id="securityAnswer" required maxlength="50" [(ngModel)]="securityAnswer" name="securityAnswer">
                <div *ngIf="answerError" class="alert alert-danger"> {{ '_RequiredSecurityPassword_' | translate }} </div>
            </div>
        </div>
        <div class="row" *ngIf="usernameOk">
            <div class="form-group">
                <label for="password"> Nova {{ '_Password_' | translate }} <span class="text-danger"> * </span></label>
                <input type="password" (input)="validatePassword()" class="form-control" id="password" required minlength="6" maxlength="255" reverse="true" [(ngModel)]="model.password" name="password" #password="ngModel">
                <div *ngIf="passwordError" class="alert alert-danger"> {{ '_RequiredPassword_' | translate }} </div>
            </div>
        </div>
        <div class=row *ngIf="usernameOk">
            <div class="form-group">
                <label for="confirmpassword">{{ '_ConfirmPassword_' | translate }} <span class="text-danger"> * </span></label>
                <input type="password" (input)="validateConfirmPassword()" class="form-control" id="confirmpassword" required validateEqual="password" [(ngModel)]="model.confirmpassword" name="confirmpassword" #confirmpassword="ngModel">
                <div *ngIf="!confirmpassword.valid && !confirmpassword.pristine && !confirmpasswordError" class="alert alert-danger"> {{ '_RequiredConfirmPassword_' | translate }} </div>
                <div *ngIf="confirmpasswordError" class="alert alert-danger"> {{ '_RequiredConfirmPassword_' | translate }} </div>
            </div>
        </div>

        <!-- buttons with ngif. after question received, change button to recover password-->
        <div class="row">
            <a *ngIf="!usernameOk" type="button" (click)="submit()" class="btn btn-success">
                <span class="glyphicon glyphicon-ok" style="font-size: small;" aria-hidden="true"></span> Validar username
            </a>
            <a *ngIf="usernameOk" type="button" (click)="recoverPassword()" class="btn btn-success">
                <span class="glyphicon glyphicon-ok" style="font-size: small;" aria-hidden="true"></span> Recuperar password
            </a>
            <button [routerLink]="['/children']" type="button" class="btn btn-secondary"> 
                <span class="glyphicon glyphicon-remove" style="font-size: small;" aria-hidden="true"></span> {{'_Cancel_' | translate }}
            </button>
        </div>
    </form>
</div>